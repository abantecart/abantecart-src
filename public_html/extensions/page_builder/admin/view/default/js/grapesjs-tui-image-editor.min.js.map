{"version":3,"file":"index.js","mappings":"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","sources":["webpack://grapesjs-tui-image-editor/webpack/universalModuleDefinition","webpack://grapesjs-tui-image-editor/webpack/bootstrap","webpack://grapesjs-tui-image-editor/webpack/runtime/define property getters","webpack://grapesjs-tui-image-editor/webpack/runtime/hasOwnProperty shorthand","webpack://grapesjs-tui-image-editor/webpack/runtime/make namespace object","webpack://grapesjs-tui-image-editor/./src/index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"grapesjs-tui-image-editor\"] = factory();\n\telse\n\t\troot[\"grapesjs-tui-image-editor\"] = factory();\n})(typeof globalThis !== 'undefined' ? globalThis : (typeof window !== 'undefined' ? window : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import type { Component, Plugin } from 'grapesjs';\nimport type tuiImageEditor from 'tui-image-editor';\n\ntype ImageEditor = tuiImageEditor.ImageEditor;\ntype IOptions = tuiImageEditor.IOptions;\ntype Constructor<K> = { new(...any: any): K };\n\nexport type PluginOptions = {\n  /**\n   * TOAST UI's configurations\n   * https://nhn.github.io/tui.image-editor/latest/ImageEditor\n   */\n  config?: IOptions;\n\n  /**\n   * Pass the editor constructor.\n   * By default, the `tui.ImageEditor` will be used.\n   */\n  constructor?: any;\n\n  /**\n   * Label for the image editor (used in the modal)\n   * @default 'Image Editor'\n   */\n  labelImageEditor?: string;\n\n  /**\n   * Label used on the apply button\n   * @default 'Apply'\n   */\n  labelApply?: string;\n\n  /**\n   * Default editor height\n   * @default '650px'\n   */\n  height?: string;\n\n  /**\n   * Default editor width\n   * @default '100%'\n   */\n  width?: string;\n\n  /**\n   * Id to use to create the image editor command\n   * @default 'tui-image-editor'\n   */\n  commandId?: string;\n\n  /**\n   * Icon used in the image component toolbar. Pass an empty string to avoid adding the icon.\n   */\n  toolbarIcon?: string;\n\n  /**\n   * Hide the default editor header\n   * @default true\n   */\n  hideHeader?: boolean;\n\n  /**\n   * By default, GrapesJS takes the modified image, adds it to the Asset Manager and update the target.\n   * If you need some custom logic you can use this custom 'onApply' function.\n   * @example\n   * onApply: (imageEditor, imageModel) => {\n   *    const dataUrl = imageEditor.toDataURL();\n   *    editor.AssetManager.add({ src: dataUrl }); // Add it to Assets\n   *    imageModel.set('src', dataUrl); // Update the image component\n   * }\n   */\n  onApply?: ((imageEditor: ImageEditor, imageModel: Component) => void) | null;\n\n  /**\n   * If no custom `onApply` is passed and this option is `true`, the result image will be added to assets\n   * @default true\n   */\n  addToAssets?: boolean;\n\n   /**\n    * If no custom `onApply` is passed, on confirm, the edited image, will be passed to the\n    * AssetManager's uploader and the result (eg. instead of having the dataURL you'll have the URL)\n    * will be passed to the default `onApply` process (update target, etc.)\n    */\n  upload?: boolean;\n\n  /**\n   * The apply button (HTMLElement) will be passed as an argument to this function, once created.\n   * This will allow you a higher customization.\n   */\n  onApplyButton?: (btn: HTMLElement) => void;\n\n  /**\n   * Scripts to load dynamically in case no TOAST UI editor instance was found\n   */\n  script?: string[];\n\n  /**\n   * In case the script is loaded this style will be loaded too\n   */\n  style?: string[];\n};\n\nconst plugin: Plugin<PluginOptions> = (editor, options = {}) => {\n  const opts: Required<PluginOptions> = {\n    config: {},\n    constructor: '',\n    labelImageEditor: 'Image Editor',\n    labelApply: 'Apply',\n    height: '650px',\n    width: '100%',\n    commandId: 'tui-image-editor',\n    toolbarIcon: `<svg viewBox=\"0 0 24 24\">\n                    <path d=\"M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z\">\n                    </path>\n                  </svg>`,\n    hideHeader: true,\n    addToAssets: true,\n    upload: false,\n    onApplyButton: () => {},\n    onApply: null,\n    script: [\n      'https://uicdn.toast.com/tui.code-snippet/v1.5.2/tui-code-snippet.min.js',\n      'https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.js',\n      'https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.js'\n    ],\n    style: [\n      'https://uicdn.toast.com/tui-color-picker/v2.2.7/tui-color-picker.min.css',\n      'https://uicdn.toast.com/tui-image-editor/v3.15.2/tui-image-editor.min.css',\n    ],\n    ...options,\n  };\n\n  const { script, style, height, width, hideHeader, onApply, upload, addToAssets, commandId } = opts;\n  const hasWindow = typeof window !== 'undefined';\n\n  const getConstructor = (): Constructor<ImageEditor> => {\n    return opts.constructor ||\n      (hasWindow && (window as any).tui?.ImageEditor);\n  };\n\n  let constr = getConstructor();\n\n  // Dynamic loading of the image editor scripts and styles\n  if (!constr && script?.length && hasWindow) {\n    const { head } = document;\n    const scripts = Array.isArray(script) ? [...script] : [script];\n    const styles = (Array.isArray(style) ? [...style] : [style]) as string[];\n    const appendStyle = (styles: string[]) => {\n      if (styles.length) {\n        const link = document.createElement('link');\n        link.href = styles.shift()!;\n        link.rel = 'stylesheet';\n        head.appendChild(link);\n        appendStyle(styles);\n      }\n    }\n    const appendScript = (scripts: string[]) => {\n      if (scripts.length) {\n        const scr = document.createElement('script');\n        scr.src = scripts.shift()!;\n        scr.onerror = scr.onload = appendScript.bind(null, scripts);\n        head.appendChild(scr);\n      } else {\n        constr = getConstructor();\n      }\n    }\n    appendStyle(styles);\n    appendScript(scripts);\n  }\n\n  // Update image component toolbar\n  if (opts.toolbarIcon) {\n    editor.Components.addType('image', {\n      extendFn: ['initToolbar'],\n      model: {\n        initToolbar() {\n          const tb = this.get('toolbar');\n          const tbExists = tb?.some(item => item.command === commandId);\n\n          if (!tbExists) {\n            tb?.unshift({\n              command: commandId,\n              label: opts.toolbarIcon,\n            });\n            this.set('toolbar', tb);\n          }\n        }\n      }\n    });\n  }\n\n  // Add the image editor command\n  const errorOpts = { level: 'error', ns: commandId };\n  editor.Commands.add(commandId, {\n    imageEditor: null as tuiImageEditor | null,\n\n    run(ed, s, options = {}) {\n      if (!constr) {\n        ed.log('TOAST UI Image editor not found', errorOpts);\n        return ed.stopCommand(commandId);\n      }\n\n      const target = (options.target || ed.getSelected()) as Component;\n\n      if (!target) {\n        ed.log('Target not available', errorOpts);\n        return ed.stopCommand(commandId);\n      }\n\n      const content = this.createContent();\n      const title = opts.labelImageEditor;\n      const btn = content.children[1] as HTMLElement;\n      ed.Modal.open({ title, content }).onceClose(() => ed.stopCommand(commandId))\n\n      const editorConfig = this.getEditorConfig(target.get('src'));\n      this.imageEditor = new constr(content.children[0], editorConfig);\n      ed.getModel().setEditing(true);\n      btn.onclick = () => this.applyChanges(target);\n      opts.onApplyButton(btn);\n    },\n\n    stop(ed) {\n      (this.imageEditor as tuiImageEditor)?.destroy();\n      ed.getModel().setEditing(false);\n    },\n\n    getEditorConfig(path: string): IOptions {\n      const config: IOptions = { ...opts.config };\n\n      if (!config.includeUI) config.includeUI = {};\n\n      config.includeUI = {\n        theme: {},\n        ...config.includeUI,\n        loadImage: { path, name: '1' },\n        uiSize: { height, width },\n      };\n\n      if (hideHeader) {\n        // @ts-ignore\n        config.includeUI.theme['header.display'] = 'none';\n      }\n\n      return config;\n    },\n\n    createContent(): HTMLDivElement {\n      const content = document.createElement('div');\n      content.style.position = 'relative';\n      content.innerHTML = `\n        <div></div>\n        <button class=\"tui-image-editor__apply-btn\" style=\"\n          position: absolute;\n          top: 0; right: 0;\n          margin: 10px;\n          background-color: #fff;\n          font-size: 1rem;\n          border-radius: 3px;\n          border: none;\n          padding: 10px 20px;\n          cursor: pointer\n        \">\n          ${opts.labelApply}\n        </botton>\n      `;\n\n      return content;\n    },\n\n    applyChanges(target: Component) {\n      const ied = this.imageEditor as tuiImageEditor;\n\n      if (onApply) {\n        onApply(ied, target);\n      } else {\n        if (ied.getDrawingMode() === 'CROPPER') {\n          ied.crop(ied.getCropzoneRect()).then(() => {\n            this.uploadImage(ied, target);\n          });\n        } else {\n          this.uploadImage(ied, target);\n        }\n      }\n    },\n\n    uploadImage(imageEditor: ImageEditor, target: Component) {\n      const am = editor.Assets;\n      const dataURL = imageEditor.toDataURL();\n\n      if (upload) {\n        const file = this.dataUrlToBlob(dataURL);\n        am.FileUploader().uploadFile({\n          dataTransfer: {\n            // @ts-ignore\n            files: [file]\n          }\n        }, (res: any) => {\n          const obj = res && res.data && res.data[0];\n          const src = obj && (typeof obj === 'string' ? obj : obj.src);\n          src && this.applyToTarget(src, target);\n        });\n      } else {\n        addToAssets && am.add({\n          src: dataURL,\n          name: (target.get('src') || '').split('/').pop(),\n        });\n        this.applyToTarget(dataURL, target);\n      }\n    },\n\n    applyToTarget(result: string, target: Component) {\n      target.set('src', result);\n      editor.Modal.close();\n    },\n\n    dataUrlToBlob(dataURL: string) {\n      const data = dataURL.split(',');\n      const byteStr = window.atob(data[1]);\n      const type = data[0].split(':')[1].split(';')[0];\n      const ab = new ArrayBuffer(byteStr.length);\n      const ia = new Uint8Array(ab);\n\n      for (let i = 0; i < byteStr.length; i++) {\n          ia[i] = byteStr.charCodeAt(i);\n      }\n\n      return new Blob([ab], { type });\n    },\n  });\n};\n\nexport default plugin;"],"names":["root","factory","exports","module","define","amd","globalThis","window","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","editor","options","opts","config","constructor","labelImageEditor","labelApply","height","width","commandId","toolbarIcon","hideHeader","addToAssets","upload","onApplyButton","onApply","script","style","hasWindow","getConstructor","tui","ImageEditor","constr","length","document","scripts","Array","isArray","styles","link","createElement","href","shift","rel","appendChild","scr","src","onerror","onload","bind","Components","addType","extendFn","model","initToolbar","tb","some","item","command","unshift","label","set","errorOpts","level","ns","Commands","add","imageEditor","run","ed","s","log","stopCommand","target","getSelected","content","createContent","title","btn","children","Modal","open","onceClose","editorConfig","getEditorConfig","getModel","setEditing","onclick","applyChanges","stop","destroy","path","includeUI","theme","loadImage","name","uiSize","position","innerHTML","ied","getDrawingMode","crop","getCropzoneRect","then","uploadImage","am","Assets","dataURL","toDataURL","file","dataUrlToBlob","FileUploader","uploadFile","dataTransfer","files","res","data","applyToTarget","split","pop","result","close","byteStr","atob","type","ab","ArrayBuffer","ia","Uint8Array","i","charCodeAt","Blob"],"sourceRoot":""}